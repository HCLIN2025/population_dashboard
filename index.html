<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人口互動式儀表板</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .chart {
            margin-top: 20px;
            width: 100%;
            height: 400px;
        }
        .latest-data {
            font-size: 16px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<h1>人口互動式儀表板</h1>

<div id="birthDeathChart" class="chart"></div>
<div class="latest-data" id="latestBirthDeathData"></div>

<div id="increaseComparisonChart" class="chart"></div>
<div class="latest-data" id="latestIncreaseData"></div>

<div id="populationChangeChart" class="chart"></div>
<div class="latest-data" id="latestPopulationData"></div>

<div id="marriagePopulationRelationChart" class="chart"></div>
<div class="latest-data" id="latestMarriageData"></div>

<script>
// 使用Fetch API加載JSON數據
fetch('https://raw.githubusercontent.com/HCLIN2025/population_dashboard/main/data.json') // 使用原始鏈接
    .then(response => {
        if (!response.ok) {
            throw new Error('網絡響應出錯');
        }
        return response.json();
    })
    .then(data => {
        createDashboard(data); // 調用創建儀表板的函數
    })
    .catch(error => {
        console.error('獲取數據時出現問題:', error);
    });

// 創建儀表板的函數
function createDashboard(data) {
    const birthData = [];
    const deathData = [];
    const natureIncreaseData = [];
    const socialIncreaseData = [];
    const marriageData = [];
    const totalPopulationData = [];
    const months = data.map(item => `${item.YEAR}-${item.MONTH}`);

    data.forEach(item => {
        // 直接將數字推入數組
        birthData.push(item.BIRTH);
        deathData.push(item.DEATH);
        natureIncreaseData.push(item['NATURE INCREASE']);
        socialIncreaseData.push(item['SOCIAL INCREASE']);
        marriageData.push(item.MARRIAGE);
        totalPopulationData.push(item.POPULATION);
    });

    // 出生與死亡趨勢圖
    const birthDeathTrace1 = {
        x: months,
        y: birthData,
        mode: 'lines+markers',
        name: '出生人數'
    };

    const birthDeathTrace2 = {
        x: months,
        y: deathData,
        mode: 'lines+markers',
        name: '死亡人數'
    };

    const birthDeathLayout = {
        title: '每月出生與死亡人數',
        xaxis: { title: '月份' },
        yaxis: { title: '人數' }
    };

    Plotly.newPlot('birthDeathChart', [birthDeathTrace1, birthDeathTrace2], birthDeathLayout);

    // 顯示最新的出生和死亡數據及變動
    document.getElementById('latestBirthDeathData').innerText =
        `最新出生人數：${birthData[birthData.length - 1]} | 最新死亡人數：${deathData[deathData.length - 1]}` +
        `\n與上個月變動：出生人數變動 ${birthData[birthData.length - 1] - birthData[birthData.length - 2]} | 死亡人數變動 ${deathData[deathData.length - 1] - deathData[deathData.length - 2]}` +
        `\n與去年同月變動：出生人數變動 ${birthData[birthData.length - 1] - birthData[birthData.length - 13]} | 死亡人數變動 ${deathData[deathData.length - 1] - deathData[deathData.length - 13]}`;

    // 自然增加與社會增加對比圖
    const increaseTrace1 = {
        x: months,
        y: natureIncreaseData,
        type: 'bar',
        name: '自然增加'
    };

    const increaseTrace2 = {
        x: months,
        y: socialIncreaseData,
        type: 'bar',
        name: '社會增加'
    };

    const increaseLayout = {
        title: '自然增加與社會增加對比',
        barmode: 'group',
        xaxis: { title: '月份' },
        yaxis: { title: '人數' }
    };

    Plotly.newPlot('increaseComparisonChart', [increaseTrace1, increaseTrace2], increaseLayout);

    // 顯示最新的自然增加和社會增加數據及變動
    document.getElementById('latestIncreaseData').innerText =
        `最新自然增加：${natureIncreaseData[natureIncreaseData.length - 1]} | 最新社會增加：${socialIncreaseData[socialIncreaseData.length - 1]}` +
        `\n與上個月變動：自然增加變動 ${natureIncreaseData[natureIncreaseData.length - 1] - natureIncreaseData[natureIncreaseData.length - 2]} | 社會增加變動 ${socialIncreaseData[socialIncreaseData.length - 1] - socialIncreaseData[socialIncreaseData.length - 2]}` +
        `\n與去年同月變動：自然增加變動 ${natureIncreaseData[natureIncreaseData.length - 1] - natureIncreaseData[natureIncreaseData.length - 13]} | 社會增加變動 ${socialIncreaseData[socialIncreaseData.length - 1] - socialIncreaseData[socialIncreaseData.length - 13]}`;

    
   // 總人口變化動態圖
   const populationChangeTrace = {
       x: months,
       y: totalPopulationData,
       mode: 'lines+markers',
       name: '總人口'
   };

   const populationChangeLayout = {
       title: '每月總人口變化',
       xaxis: { title: '月份' },
       yaxis: { title: '總人口' }
   };

   Plotly.newPlot('populationChangeChart', [populationChangeTrace], populationChangeLayout);

   // 顯示最新的總人口數據及變動
   document.getElementById('latestPopulationData').innerText =
       `最新總人口：${totalPopulationData[totalPopulationData.length - 1]}` +
       `\n與上個月變動：總人口變動 ${totalPopulationData[totalPopulationData.length - 1] - totalPopulationData[totalPopulationData.length - 2]}` +
       `\n與去年同月變動：總人口變動 ${totalPopulationData[totalPopulationData.length - 1] - totalPopulationData[totalPopulationData.length - 13]}`;

   // 婚姻數量與總人口關係圖
   const marriagePopulationTrace = {
       x: marriageData,
       y: totalPopulationData,
       mode: 'markers',
       type: 'scatter',
       name: '婚姻數量 vs 總人口'
   };

   const marriagePopulationLayout = {
       title: '婚姻數量與總人口關係',
       xaxis: { title: '婚姻數量' },
       yaxis: { title: '總人口' }
   };

   Plotly.newPlot('marriagePopulationRelationChart', [marriagePopulationTrace], marriagePopulationLayout);

   // 顯示最新的婚姻數量和總人口數據
   document.getElementById('latestMarriageData').innerText =
       `最新婚姻數量：${marriageData[marriageData.length - 1]}`;
}
</script>

</body>
</html>




<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人口互動式儀表板</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .chart {
            margin-top: 20px;
            width: 100%;
            height: 400px;
        }
        .latest-data {
            font-size: 16px;
            margin-top: 10px;
        }
        .slider-container {
            margin-bottom: 20px;
        }
        .data-container {
            display: flex;
            justify-content: space-between; /* 在主軸上分配空間 */
            align-items: stretch; /* 確保子元素高度一致 */
        }
        .data-box {
            padding: 20px;
            margin: 10px;
            border-radius: 5px;
            color: white;
            flex-basis: 30%; /* 每個方框佔據30%寬度 */
            display: flex;
            flex-direction: column; /* 垂直排列內容 */
        }
        .birth { background-color: #2a9d8f; } /* 綠色 */
        .death { background-color: #e9c46a; } /* 紅色 */
        .population { background-color: #264653; } /* 藍色 */
        .natural-increase { background-color: #f4a261; } /* 橙色 */
        .social-increase { background-color: #e76f51; } /* 紫色 */
        .data-value {
            font-weight: bold; 
            font-size: 24px; /* 數據字體大於標題 */
        }
    </style>
</head>
<body>

<h1>人口互動儀表板</h1>

<div class="slider-container">
    <label for="yearSlider">選擇年份:</label>
    <div id="yearSlider"></div>
    <span id="selectedYear">2021</span>

    <label for="monthSlider">選擇月份:</label>
    <div id="monthSlider"></div>
    <span id="selectedMonth">1</span>

    <button id="filterButton">篩選資料</button>
</div>

<div class="data-container">
    <div class="data-box birth">
        <h2 id="birthTitle">○年○月出生人數</h2>
        <p class="data-value" id="birthData">0</p>
        <p>上月變動：<span id="birthChange">0</span></p>
    </div>

    <div class="data-box death">
        <h2 id="deathTitle">○年○月死亡人數</h2>
        <p class="data-value" id="deathData">0</p>
        <p>上月變動：<span id="deathChange">0</span></p>
    </div>

    <div class="data-box population">
        <h2 id="populationTitle">○年○月總人口數</h2>
        <p class="data-value" id="populationData">0</p>
        <p>上月變動：<span id="populationChange">0</span></p>
    </div>

    <div class="data-box natural-increase">
        <h2 id="naturalIncreaseTitle">○年○月自然增加</h2>
        <p class="data-value" id="naturalIncreaseData">0</p>
        <p>上月變動：<span id="naturalIncreaseChange">0</span></p>
    </div>

    <div class="data-box social-increase">
        <h2 id="socialIncreaseTitle">○年○月社會增加</h2>
        <p class="data-value" id="socialIncreaseData">0</p>
        <p>上月變動：<span id="socialIncreaseChange">0</span></p>
    </div>
</div>

<div id="birthDeathChart" class="chart"></div>
<div class="latest-data" id="latestBirthDeathData"></div>

<div id="increaseComparisonChart" class="chart"></div>
<div class="latest-data" id="latestIncreaseData"></div>

<div id="populationChangeChart" class="chart"></div>
<div class="latest-data" id="latestPopulationData"></div>

<div id="marriagePopulationRelationChart" class="chart"></div>
<div class="latest-data" id="latestMarriageData"></div>

<script>
// 使用Fetch API加載JSON數據
fetch('https://raw.githubusercontent.com/HCLIN2025/population_dashboard/main/data.json') // 使用原始鏈接
    .then(response => {
        if (!response.ok) {
            throw new Error('網絡響應出錯');
        }
        return response.json();
    })
    .then(data => {
        window.data = data; // 將數據存儲在全局變量中
        createDashboard(data); // 調用創建儀表板的函數
    })
    .catch(error => {
        console.error('獲取數據時出現問題:', error);
    });

// 創建儀表板的函數
function createDashboard(data) {
    const birthData = [];
    const deathData = [];
    const natureIncreaseData = [];
    const socialIncreaseData = [];
    const marriageData = [];
    const totalPopulationData = [];

    const months = data.map(item => `${item.YEAR}-${item.MONTH}`);

    data.forEach(item => {
        birthData.push(item.BIRTH);
        deathData.push(item.DEATH);
        natureIncreaseData.push(item['NATURE INCREASE']);
        socialIncreaseData.push(item['SOCIAL INCREASE']);
        marriageData.push(item.MARRIAGE);
        totalPopulationData.push(item.POPULATION);
        
        // 更新標題為最新日期
        document.getElementById('birthTitle').innerText = `${item.YEAR}年${item.MONTH}月出生人數`;
        document.getElementById('deathTitle').innerText = `${item.YEAR}年${item.MONTH}月死亡人數`;
        document.getElementById('populationTitle').innerText = `${item.YEAR}年${item.MONTH}月總人口數`;
        document.getElementById('naturalIncreaseTitle').innerText = `${item.YEAR}年${item.MONTH}月自然增加`;
        document.getElementById('socialIncreaseTitle').innerText = `${item.YEAR}年${item.MONTH}月社會增加`;
    });

   // 更新最新的出生和死亡數據
   document.getElementById('birthData').innerText = birthData[birthData.length - 1];
   document.getElementById('deathData').innerText = deathData[deathData.length - 1];
   document.getElementById('populationData').innerText = totalPopulationData[totalPopulationData.length - 1];
   document.getElementById('naturalIncreaseData').innerText = natureIncreaseData[natureIncreaseData.length - 1];
   document.getElementById('socialIncreaseData').innerText = socialIncreaseData[socialIncreaseData.length - 1];

   // 計算上月變動
   document.getElementById('birthChange').innerText = birthData[birthData.length - 1] - birthData[birthData.length - 2];
   document.getElementById('deathChange').innerText = deathData[deathData.length - 1] - deathData[deathData.length - 2];
   document.getElementById('populationChange').innerText = totalPopulationData[totalPopulationData.length - 1] - totalPopulationData[totalPopulationData.length - 2];
   document.getElementById('naturalIncreaseChange').innerText = natureIncreaseData[natureIncreaseData.length - 1] - natureIncreaseData[natureIncreaseData.length - 2];
   document.getElementById('socialIncreaseChange').innerText = socialIncreaseData[socialIncreaseData.length - 1] - socialIncreaseData[socialIncreaseData.length - 2];

   // 出生與死亡趨勢圖
   const birthDeathTrace1 = {
       x: months,
       y: birthData,
       mode: 'lines+markers',
       name: '出生人數'
   };

   const birthDeathTrace2 = {
       x: months,
       y: deathData,
       mode: 'lines+markers',
       name: '死亡人數'
   };

   const birthDeathLayout = {
       title: '每月出生與死亡人數',
       xaxis: { title: '月份' },
       yaxis: { title: '人數' }
   };

   Plotly.newPlot('birthDeathChart', [birthDeathTrace1, birthDeathTrace2], birthDeathLayout);

   // 自然增加與社會增加對比圖
   const increaseTrace1 = {
       x: months,
       y: natureIncreaseData,
       type: 'bar',
       name: '自然增加'
   };

   const increaseTrace2 = {
       x: months,
       y: socialIncreaseData,
       type: 'bar',
       name: '社會增加'
   };

   const increaseLayout = {
       title: '自然增加與社會增加對比',
       barmode: 'group',
       xaxis: { title: '月份' },
       yaxis: { title: '人數' }
   };

   Plotly.newPlot('increaseComparisonChart', [increaseTrace1, increaseTrace2], increaseLayout);

   // 總人口變化動態圖
   const populationChangeTrace = {
       x: months,
       y: totalPopulationData,
       mode: 'lines+markers',
       name: '總人口'
   };

   const populationChangeLayout = {
       title: '每月總人口變化',
       xaxis: { title: '月份' },
       yaxis: { title: '總人口' }
   };

   Plotly.newPlot('populationChangeChart', [populationChangeTrace], populationChangeLayout);

   // 婚姻數量與總人口關係圖
   const marriagePopulationTrace = {
       x: marriageData,
       y: totalPopulationData,
       mode: 'markers',
       type: 'scatter',
       name: '婚姻數量 vs 總人口'
   };

   const marriagePopulationLayout = {
       title: '婚姻數量與總人口關係',
       xaxis: { title: '婚姻數量' },
       yaxis: { title: '總人口' }
   };

   Plotly.newPlot('marriagePopulationRelationChart', [marriagePopulationTrace], marriagePopulationLayout);
}

// 初始化年份和月份滑動條
$(function() {
    $("#yearSlider").slider({
        min: 2021,
        max: 2024,
        value: 2021,
        slide(event, ui) {
            $("#selectedYear").text(ui.value);
            updateCharts(); // 更新圖表以反映新的年份篩選器
        }
    });

    $("#monthSlider").slider({
        min: 1,
        max: 12,
        value: 1,
        slide(event, ui) {
            $("#selectedMonth").text(ui.value);
            updateCharts(); // 更新圖表以反映新的月份篩選器
        }
    });
});

// 更新圖表以反映篩選器的變化
function updateCharts() {
     // 根據選擇的年份和月份更新圖表的邏輯可以在這裡實現。
}

// 篩選資料函數
document.getElementById('filterButton').addEventListener('click', () => {
    const selectedYear = parseInt($("#yearSlider").slider("value"));
    const selectedMonth = parseInt($("#monthSlider").slider("value"));
    
    // 篩選資料邏輯
    const filteredData = window.data.filter(item => item.YEAR === selectedYear && item.MONTH === selectedMonth);

    createDashboard(filteredData); // 使用篩選後的資料重新創建儀表板
});
</script>

</body>
</html>









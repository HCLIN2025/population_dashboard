<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人口互動式儀表板</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .chart {
            margin-top: 20px;
            width: 100%;
            height: 400px;
        }
        .latest-data {
            font-size: 16px;
            margin-top: 10px;
        }
        .data-container {
            display: flex;
            justify-content: space-between;
            align-items: stretch;
        }
        .data-box {
            padding: 20px;
            margin: 10px;
            border-radius: 5px;
            color: white;
            flex-basis: 30%;
            display: flex;
            flex-direction: column;
        }
        .birth { background-color: #2a9d8f; }
        .death { background-color: #e9c46a; }
        .population { background-color: #264653; }
        .natural-increase { background-color: #f4a261; }
        .social-increase { background-color: #e76f51; }
        .data-value {
            font-weight: bold;
            font-size: 24px;
        }
        .slider-container {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<h1>人口互動儀表板</h1>

<div class="data-container">
    <div class="data-box birth">
        <h2 id="birthTitle">最新出生人數</h2>
        <p class="data-value" id="birthData">0</p>
        <p id="birthComparison"></p>
    </div>

    <div class="data-box death">
        <h2 id="deathTitle">最新死亡人數</h2>
        <p class="data-value" id="deathData">0</p>
        <p id="deathComparison"></p>
    </div>

    <div class="data-box population">
        <h2 id="populationTitle">最新總人口數</h2>
        <p class="data-value" id="populationData">0</p>
        <p id="populationComparison"></p>
    </div>

    <div class="data-box natural-increase">
        <h2 id="naturalIncreaseTitle">最新自然增加</h2>
        <p class="data-value" id="naturalIncreaseData">0</p>
        <p id="naturalIncreaseComparison"></p>
    </div>

    <div class="data-box social-increase">
        <h2 id="socialIncreaseTitle">最新社會增加</h2>
        <p class="data-value" id="socialIncreaseData">0</p>
        <p id="socialIncreaseComparison"></p>
    </div>
</div>

<div class="slider-container">
    <label for="timeRangeSlider">選擇時間範圍:</label>
    <div id="timeRangeSlider"></div>
    <span id="selectedTimeRange">2021-01 至 2024-12</span>
    <button id="filterButton">篩選資料</button>
</div>

<div id="birthDeathChart" class="chart"></div>
<div id="increaseComparisonChart" class="chart"></div>
<div id="populationChangeChart" class="chart"></div>
<div id="marriagePopulationRelationChart" class="chart"></div>

<script>
let rawData = [];

// 獲取數據並初始化
fetch('https://raw.githubusercontent.com/HCLIN2025/population_dashboard/main/data.json')
    .then(response => response.json())
    .then(data => {
        rawData = data;
        displayLatestData();
        initializeSlider();
        createDashboard(data);
    });

// 顯示最新數據
function displayLatestData() {
    const latest = rawData[rawData.length - 1];
    const previousMonth = rawData[rawData.length - 2] || {};
    const previousYear = rawData.find(item => item.YEAR === latest.YEAR - 1 && item.MONTH === latest.MONTH) || {};

    document.getElementById('birthData').innerText = latest.BIRTH;
    document.getElementById('birthComparison').innerText = `上月比較: ${(latest.BIRTH - (previousMonth.BIRTH || 0))}，同比去年: ${(latest.BIRTH - (previousYear.BIRTH || 0))}`;

    document.getElementById('deathData').innerText = latest.DEATH;
    document.getElementById('deathComparison').innerText = `上月比較: ${(latest.DEATH - (previousMonth.DEATH || 0))}，同比去年: ${(latest.DEATH - (previousYear.DEATH || 0))}`;

    document.getElementById('populationData').innerText = latest.POPULATION;
    document.getElementById('populationComparison').innerText = `上月比較: ${(latest.POPULATION - (previousMonth.POPULATION || 0))}，同比去年: ${(latest.POPULATION - (previousYear.POPULATION || 0))}`;

    document.getElementById('naturalIncreaseData').innerText = latest['NATURE INCREASE'];
    document.getElementById('naturalIncreaseComparison').innerText = `上月比較: ${(latest['NATURE INCREASE'] - (previousMonth['NATURE INCREASE'] || 0))}，同比去年: ${(latest['NATURE INCREASE'] - (previousYear['NATURE INCREASE'] || 0))}`;

    document.getElementById('socialIncreaseData').innerText = latest['SOCIAL INCREASE'];
    document.getElementById('socialIncreaseComparison').innerText = `上月比較: ${(latest['SOCIAL INCREASE'] - (previousMonth['SOCIAL INCREASE'] || 0))}，同比去年: ${(latest['SOCIAL INCREASE'] - (previousYear['SOCIAL INCREASE'] || 0))}`;

    document.getElementById('birthTitle').innerText = `${latest.YEAR}年${latest.MONTH}月最新出生人數`;
    document.getElementById('deathTitle').innerText = `${latest.YEAR}年${latest.MONTH}月最新死亡人數`;
    document.getElementById('populationTitle').innerText = `${latest.YEAR}年${latest.MONTH}月最新總人口數`;
    document.getElementById('naturalIncreaseTitle').innerText = `${latest.YEAR}年${latest.MONTH}月最新自然增加`;
    document.getElementById('socialIncreaseTitle').innerText = `${latest.YEAR}年${latest.MONTH}月最新社會增加`;
}

// 初始化滑動條
function initializeSlider() {
    const timeLabels = rawData.map(item => `${item.YEAR}-${String(item.MONTH).padStart(2, '0')}`);

    $("#timeRangeSlider").slider({
        range: true,
        min: 0,
        max: timeLabels.length - 1,
        values: [0, timeLabels.length - 1],
        slide: function(event, ui) {
            const start = timeLabels[ui.values[0]];
            const end = timeLabels[ui.values[1]];
            $("#selectedTimeRange").text(`${start} 至 ${end}`);
        }
    });

    const start = timeLabels[0];
    const end = timeLabels[timeLabels.length - 1];
    $("#selectedTimeRange").text(`${start} 至 ${end}`);
}
// 篩選資料並更新儀表板
function filterData() {
    const timeLabels = rawData.map(item => `${item.YEAR}-${String(item.MONTH).padStart(2, '0')}`);
    const [startIdx, endIdx] = $("#timeRangeSlider").slider("values");
    const filteredData = rawData.slice(startIdx, endIdx + 1);
    createDashboard(filteredData);
}

document.getElementById('filterButton').addEventListener('click', filterData);

// 建立儀表板
function createDashboard(data) {
    const months = data.map(item => `${item.YEAR}-${item.MONTH}`);
    const birthData = data.map(item => item.BIRTH);
    const deathData = data.map(item => item.DEATH);

    // 出生與死亡趨勢圖
    Plotly.newPlot('birthDeathChart', [
        { x: months, y: birthData, mode: 'lines+markers', name: '出生人數' },
        { x: months, y: deathData, mode: 'lines+markers', name: '死亡人數' }
    ], {
        title: '每月出生與死亡人數',
        xaxis: { title: '月份' },
        yaxis: { title: '人數' }
    });
// 自然與社會增加對比圖
const naturalIncrease = data.map(item => item['NATURE INCREASE']);
    const socialIncrease = data.map(item => item['SOCIAL INCREASE']);
    Plotly.newPlot('increaseComparisonChart', [
        { x: months, y: naturalIncrease, mode: 'lines+markers', name: '自然增加' },
        { x: months, y: socialIncrease, mode: 'lines+markers', name: '社會增加' }
    ], {
        title: '自然增加與社會增加對比',
        xaxis: { title: '月份' },
        yaxis: { title: '人數' }
    });

    // 總人口變化圖
    const population = data.map(item => item.POPULATION);
    Plotly.newPlot('populationChangeChart', [
        { x: months, y: population, mode: 'lines+markers', name: '總人口數' }
    ], {
        title: '總人口變化趨勢',
        xaxis: { title: '月份' },
        yaxis: { title: '人數' }
    });

    // 婚姻與人口關係圖
    const marriages = data.map(item => item.MARRIAGES);
    Plotly.newPlot('marriagePopulationRelationChart', [
        { x: marriages, y: population, mode: 'markers', name: '婚姻與總人口' }
    ], {
        title: '婚姻與人口數關係',
        xaxis: { title: '婚姻數' },
        yaxis: { title: '總人口數' }
    });
}
</script>
</body>
</html>










